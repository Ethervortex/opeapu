{% extends "base.html" %}
{% block title %}Oppilas{% endblock %}
{% block link %}
    {% if session.username %}
        {{ super() }}
    {% endif %}
{% endblock %}
{% block content %}
    <h2>{{ student_name }}</h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <div id="flash-messages" class="flash-messages">
            {% for category, message in messages %}
                <p class="flash-message {{ category }}">{{ message }}</p>
            {% endfor %}
        </div>
    {% endif %}
    {% endwith %}

    <b>Oppilaan kurssit:</b>
    {% for course, data in course_activities.items() %}
        <h3>{{ course }}</h3>
        <table border="1">
            <thead>
                <tr>
                    <th>Päivämäärä</th>
                    <th>Tuntiaktiivisuus</th>
                </tr>
            </thead>
            <tbody>
                {% for activity in data.activities %}
                    <tr>
                        <td>{{ activity.activity_date }}</td>
                        <td>
                            {% if activity.activity_score == -1 %}
                                poissa
                            {% else %}
                                {{ activity.activity_score }}
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        <b>Tuntiaktiivisuus ka: </b>{{ data.mean_score }}</th><br>
        <b>Poissaolot: </b>{{ data.absence }} kpl</th>
    {% endfor %}

    <br><br>
    <div class="button-container">
        <button id="delete-student-button">Poista oppilas</button>
    </div>

    <script>
        document.getElementById("delete-student-button").addEventListener("click", () => {
            const confirmation = confirm("Oletko varma, että haluat poistaa tämän oppilaan?");
            if (confirmation) {
                // If the user confirms, submit the form
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/student/{{ student_id }}';
                document.body.appendChild(form);
                form.submit();
            }
        });
    </script>
{% endblock %}